<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Exploding Markets ‚Äî Live Market Pulse Dashboard</title>
<meta name="description" content="Exploding Markets ‚Äî Live Market Pulse (Indian markets + Crypto) with The Money Manual (500 Laws + 100 Flashcards)."/>
<meta name="keywords" content="Indian stock market, crypto, finance, investing, market dashboard, trading, finance courses"/>
<meta property="og:title" content="Exploding Markets ‚Äî Live Market Pulse Dashboard"/>
<meta property="og:description" content="Real-time Indian indices & crypto with 500 timeless money laws and 100 flashcards. Built by Vansh."/>
<meta property="og:type" content="website"/>
<meta name="twitter:card" content="summary_large_image"/>
<link rel="icon" href="data:,">
<style>
  /* ------------- THEME & RESET ------------- */
  *{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#081226; --card:#111827; --muted:#9fb0c6; --accent:#f59e0b;
    --glow: rgba(245,158,11,0.18); --green:#10b981; --red:#ef4444; --maxw:1300px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;background:linear-gradient(180deg,#071226 0%, #041226 100%);color:#e6eef6;-webkit-font-smoothing:antialiased}
  a{color:inherit}
  .wrap{max-width:var(--maxw);margin:0 auto;padding:18px}

  /* NAV */
  nav{position:fixed;inset:0 0 auto 0;background:rgba(10,14,32,0.8);backdrop-filter:blur(8px);border-bottom:1px solid rgba(245,158,11,0.12);z-index:1100}
  .nav-inner{max-width:var(--maxw);margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#ff6b6b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071226}
  .brand h1{font-size:18px}
  .nav-links{display:flex;gap:14px;align-items:center}
  .nav-links a{color:var(--muted);text-decoration:none;padding:6px 8px;border-radius:8px;font-weight:600}
  .nav-links a:hover{color:var(--accent);background:rgba(255,255,255,0.02)}
  .menu-btn{display:none;background:none;border:0;color:var(--muted);font-size:20px}
  .scroll-line{position:fixed;left:0;top:0;height:3px;background:linear-gradient(90deg,var(--accent),#d97706);width:0%;z-index:1200;transition:width .12s linear}

  /* HERO */
  .hero{min-height:80vh;display:flex;align-items:center;justify-content:center;padding:90px 20px 40px;text-align:center;position:relative;overflow:hidden}
  .hero .inner{max-width:980px}
  .hero h2{font-size:clamp(2rem,6vw,3.8rem);font-weight:900;background:linear-gradient(135deg,#fff,var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .hero p{margin-top:10px;color:var(--muted);font-size:1.05rem}
  .mood-bar{margin-top:24px;max-width:640px;margin-left:auto;margin-right:auto;background:rgba(255,255,255,0.02);border-radius:12px;padding:10px;border:1px solid rgba(245,158,11,0.12)}
  .mood-ind{height:56px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;transition:all .45s ease}

  /* SECTIONS */
  section{padding:64px 20px}
  .section-head{max-width:var(--maxw);margin:0 auto 18px;text-align:center}
  .section-head h3{font-size:clamp(1.6rem,3vw,2.6rem);color:var(--accent)}
  .section-head p{color:var(--muted);margin-top:8px}

  /* MARKET CARDS */
  .grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));max-width:var(--maxw);margin:18px auto}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
  .card .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .card .name{font-weight:800}
  .price{font-size:28px;font-weight:900;margin-bottom:6px}
  .change.pos{color:var(--green)} .change.neg{color:var(--red)}
  .meta{color:var(--muted);font-size:13px;margin-top:10px}

  /* MONEY MANUAL - LAWS */
  .search-wrap{max-width:760px;margin:0 auto;margin-bottom:18px}
  .search{width:100%;padding:12px;border-radius:999px;background:var(--card);border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
  .laws-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));max-width:var(--maxw);margin:18px auto}
  .law{background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);opacity:0;transform:translateY(18px);transition:all .45s cubic-bezier(.15,.9,.3,1)}
  .law.visible{opacity:1;transform:none}
  .law .num{color:var(--accent);font-weight:700;margin-bottom:8px}
  .law .t{font-weight:800;margin-bottom:6px}
  .load-more{display:block;margin:22px auto;padding:12px 22px;border-radius:999px;background:var(--accent);color:#071226;font-weight:800;border:0;cursor:pointer}

  /* FLASHCARDS */
  .flash-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));max-width:var(--maxw);margin:18px auto}
  .flash{height:190px;perspective:1000px;cursor:pointer}
  .inner{position:relative;width:100%;height:100%;transition:transform .6s;transform-style:preserve-3d;border-radius:12px}
  .flip .inner{transform:rotateY(180deg)}
  .side{position:absolute;inset:0;border-radius:12px;padding:16px;display:flex;align-items:center;justify-content:center;text-align:center;backface-visibility:hidden}
  .front{background:linear-gradient(135deg,var(--card), rgba(245,158,11,0.06));border:1px solid rgba(255,255,255,0.03)}
  .back{background:linear-gradient(135deg, rgba(245,158,11,0.06),var(--card));transform:rotateY(180deg);border:1px solid rgba(245,158,11,0.12);color:var(--muted)}

  /* CALCULATOR */
  .calc-wrap{max-width:720px;margin:0 auto}
  .calc{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .calc label{display:block;color:var(--muted);font-weight:700;margin-bottom:6px}
  .calc input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:#071226;color:var(--muted)}
  .calc-btn{margin-top:12px;padding:12px;border-radius:10px;border:0;background:var(--accent);color:#071226;font-weight:800;cursor:pointer}

  /* SUPPORT & AFFILIATES */
  .support{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
  .support a{padding:12px 20px;border-radius:999px;background:linear-gradient(90deg,var(--accent),#d97706);color:#071226;font-weight:800;text-decoration:none}
  .affiliate-note{max-width:900px;margin:14px auto;color:var(--muted);font-size:0.95rem;text-align:center}

  /* FOOTER */
  footer{padding:26px;text-align:center;color:var(--muted)}

  /* to-top */
  #toTop{position:fixed;right:20px;bottom:86px;padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#071226;font-weight:800;cursor:pointer;display:none;z-index:1400}

  /* responsive */
  @media (max-width:880px){
    .hero{padding-top:120px}
    .nav-links{display:none}
    .menu-btn{display:block}
  }
</style>
</head>
<body>
  <div class="scroll-line" id="scrollLine"></div>

  <nav>
    <div class="nav-inner wrap">
      <div class="brand"><div class="logo">EM</div><h1>Exploding Markets</h1></div>
      <div class="nav-links" id="navLinks">
        <a href="#home">Home</a>
        <a href="#markets">Markets</a>
        <a href="#crypto">Crypto</a>
        <a href="#money-manual">Money Manual</a>
        <a href="#calculator">Calculator</a>
        <a href="#support">Support ‚òï</a>
        <a href="#courses">Courses</a>
      </div>
      <button class="menu-btn" id="menuBtn" aria-label="Toggle menu">‚ò∞</button>
    </div>
  </nav>

  <!-- HERO -->
  <main id="home" class="hero" role="main">
    <div class="inner">
      <h2>Exploding Markets</h2>
      <p>Live Market Pulse ‚Äî real-time Indian indices & global crypto</p>
      <div class="mood-bar"><div id="mood" class="mood-ind">Loading market mood...</div></div>
    </div>
  </main>

  <!-- INDIAN MARKETS -->
  <section id="markets" aria-labelledby="markets-heading">
    <div class="section-head">
      <h3 id="markets-heading">Indian Markets</h3>
      <p class="muted">Auto-refresh every 60s ‚Äî press <strong>R</strong> to refresh manually</p>
    </div>
    <div class="grid" id="indianGrid" aria-live="polite"></div>
  </section>

  <!-- CRYPTO -->
  <section id="crypto" aria-labelledby="crypto-heading">
    <div class="section-head">
      <h3 id="crypto-heading">Cryptocurrency Markets</h3>
      <p class="muted">Data from CoinGecko (cached locally)</p>
    </div>
    <div class="grid" id="cryptoGrid" aria-live="polite"></div>
  </section>

  <!-- COURSES / AFFILIATES -->
  <section id="courses" aria-labelledby="courses-heading">
    <div class="section-head">
      <h3 id="courses-heading">Recommended Courses & Tools</h3>
      <p class="muted">Handpicked courses for traders & investors (affiliate links).</p>
    </div>
    <div class="grid" style="max-width:1000px;margin:0 auto;">
      <!-- Binance affiliate (example CTA) -->
      <div class="card" style="display:flex;flex-direction:column;gap:8px;">
        <div class="top"><div class="name">Binance (Exchange)</div><div class="badge">Affiliate</div></div>
        <div style="font-weight:800">Start trading crypto</div>
        <div style="color:var(--muted);font-size:13px">Sign up via our affiliate link for trading. We may earn commission.</div>
        <div style="margin-top:auto">
          <!-- Replace the placeholder with your real affiliate link -->
          <a class="support" href="https://www.binance.com/en/register?ref=YOUR_BINANCE_REF" target="_blank" rel="noopener" style="display:inline-block;margin-top:10px;padding:10px 14px;border-radius:8px;background:rgba(255,255,255,0.03);font-weight:700;color:var(--muted);text-decoration:none">Open Binance ‚Üí</a>
        </div>
      </div>

      <!-- Course affiliate example 1 -->
      <div class="card" style="display:flex;flex-direction:column;gap:8px;">
        <div class="top"><div class="name">Trading Course ‚Äî Example A</div><div class="badge">Affiliate</div></div>
        <div style="font-weight:800">Complete trading fundamentals</div>
        <div style="color:var(--muted);font-size:13px">Learn technicals, risk management & psychology.</div>
        <div style="margin-top:auto">
          <a class="support" href="https://example-course-site.com/affiliate/your-ref" target="_blank" rel="noopener" style="display:inline-block;margin-top:10px;padding:10px 14px;border-radius:8px;background:rgba(255,255,255,0.03);font-weight:700;color:var(--muted);text-decoration:none">View Course ‚Üí</a>
        </div>
      </div>

      <!-- Course affiliate example 2 -->
      <div class="card" style="display:flex;flex-direction:column;gap:8px;">
        <div class="top"><div class="name">Investing Course ‚Äî Example B</div><div class="badge">Affiliate</div></div>
        <div style="font-weight:800">Long-term investing & personal finance</div>
        <div style="color:var(--muted);font-size:13px">Tax-efficient strategies for Indian investors.</div>
        <div style="margin-top:auto">
          <a class="support" href="https://example-course-2.com/ref/your-ref" target="_blank" rel="noopener" style="display:inline-block;margin-top:10px;padding:10px 14px;border-radius:8px;background:rgba(255,255,255,0.03);font-weight:700;color:var(--muted);text-decoration:none">View Course ‚Üí</a>
        </div>
      </div>
    </div>

    <p class="affiliate-note">Affiliate disclosure: Some links on this site are affiliate links ‚Äî at no extra cost to you, we may earn a commission if you make a purchase or sign up. Always research and trade responsibly.</p>
  </section>

  <!-- MONEY MANUAL (lazy init) -->
  <section id="money-manual" aria-labelledby="money-heading">
    <div class="section-head">
      <h3 id="money-heading">The Money Manual</h3>
      <p class="muted">500 Timeless Money Laws & 100 Finance Flashcards ‚Äî loads when you view this section</p>
    </div>

    <div class="search-wrap" id="moneyLoader">
      <input id="lawSearch" class="search" placeholder="üîç Search laws..." aria-label="Search laws"/>
    </div>

    <div id="lawsGrid" class="laws-grid" aria-live="polite"></div>
    <button id="loadMore" class="load-more" style="display:none">Load More Laws</button>

    <div style="margin-top:36px"></div>
    <div id="flashGrid" class="flash-grid" aria-live="polite"></div>
  </section>

  <!-- CALCULATOR -->
  <section id="calculator" aria-labelledby="calc-heading">
    <div class="section-head">
      <h3 id="calc-heading">Compound Interest Calculator</h3>
      <p class="muted">Enter monthly amount, expected annual return, and years.</p>
    </div>
    <div class="calc-wrap">
      <div class="calc" role="form" aria-label="Compound interest calculator">
        <label for="monthly">Monthly Investment (‚Çπ)</label>
        <input id="monthly" type="number" value="10000" min="0"/>
        <label for="annual" style="margin-top:12px">Expected Annual Return (%)</label>
        <input id="annual" type="number" value="12" min="0" step="0.1"/>
        <label for="years" style="margin-top:12px">Years</label>
        <input id="years" type="number" value="10" min="1"/>
        <button id="calcBtn" class="calc-btn" aria-label="Calculate">Calculate Wealth</button>

        <div id="calcResults" style="display:none;margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)" aria-live="polite">
          <div>Total Invested: <strong id="invested">‚Çπ0</strong></div>
          <div>Final Value: <strong id="final">‚Çπ0</strong></div>
          <div>Profit: <strong id="profit">‚Çπ0</strong></div>
        </div>
      </div>
    </div>
  </section>

  <!-- SUPPORT -->
  <section id="support" aria-labelledby="support-heading">
    <div class="section-head">
      <h3 id="support-heading">Support Exploding Markets ‚òï</h3>
      <p class="muted">If this helps you, buy a coffee ‚Äî keeps the dashboard alive.</p>
    </div>
    <div class="support">
      <a href="https://www.buymeacoffee.com/VanshPandit" target="_blank" rel="noopener">‚òï Support Vansh (Global)</a>
    </div>
  </section>

  <button id="toTop" aria-label="Scroll to top">‚Üë</button>

  <footer>
    Made with ‚ù§Ô∏è by Vansh
  </footer>

  <!-- floating BuyMeACoffee widget (optional popup) -->
  <script data-name="BMC-Widget" data-cfasync="false"
    src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
    data-id="VanshPandit"
    data-description="Support Exploding Markets"
    data-message="Fuel the dashboard ‚òï"
    data-color="#f59e0b"
    data-position="Right"
    data-x_margin="20"
    data-y_margin="20"></script>

<script>
/* ===================== Exploding Markets v2.0 - optimized logic ===================== */
/* - Lazy-inits Money Manual only when visible
   - Caches crypto in localStorage (60s)
   - Progressive render for laws and flashcards
   - Scroll reveal using IntersectionObserver
   - Keyboard shortcuts: R=refresh, L=jump to Money Manual
   - To-top button, throttle helper, escapeHtml, shuffle, copy
*/

(() => {
  // utilities
  const $ = id => document.getElementById(id);
  function el(tag, cls, html) { const e = document.createElement(tag); if(cls) e.className = cls; if(html) e.innerHTML = html; return e; }
  function throttle(fn, wait){ let last=0; return (...a)=>{ const now=Date.now(); if(now-last>=wait){ last=now; fn.apply(this,a); last=now;} } }
  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr }
  function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
  function showToast(msg){ const t = el('div','toast',msg); t.style.position='fixed'; t.style.right='18px'; t.style.top='18px'; t.style.padding='10px 14px'; t.style.background= 'var(--accent)'; t.style.color='#071226'; t.style.borderRadius='8px'; t.style.zIndex=9999; document.body.appendChild(t); setTimeout(()=> t.style.opacity='0',1400); setTimeout(()=> t.remove(),1800); }

  // NAV mobile toggle
  const menuBtn = $('menuBtn');
  menuBtn.addEventListener('click', ()=> {
    const links = document.querySelector('.nav-links');
    if(getComputedStyle(links).display === 'none' || links.style.display === '') links.style.display = 'flex';
    else links.style.display = 'none';
  });

  // scroll progress line
  const scrollLine = $('scrollLine');
  function updateScrollLine(){
    const top = window.pageYOffset || document.documentElement.scrollTop;
    const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const pct = height? Math.round((top/height)*100) : 0;
    if(scrollLine) scrollLine.style.width = pct + '%';
    // toTop button
    const toTop = $('toTop');
    if(toTop) toTop.style.display = (top > 400) ? 'block' : 'none';
  }
  window.addEventListener('scroll', throttle(updateScrollLine, 100));
  updateScrollLine();

  // toTop button
  $('toTop').addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));

  // keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if(e.key === 'r' || e.key === 'R') { fetchCrypto(true); renderIndianMarkets(true); showToast('Refreshing data'); }
    if(e.key === 'l' || e.key === 'L') { document.querySelector('#money-manual').scrollIntoView({behavior:'smooth'}); }
  });

  // -------------------- INDIAN MARKETS (simulated placeholder; replace with real API) --------------------
  async function renderIndianMarkets(force=false){
    const grid = $('indianGrid');
    grid.innerHTML = '';
    const markets = [
      {name:'NIFTY 50', base:24500, symbol:'NSEI'},
      {name:'SENSEX', base:80500, symbol:'BSESN'},
      {name:'BANK NIFTY', base:52500, symbol:'NSEBANK'},
      {name:'NIFTY IT', base:42000, symbol:'CNXIT'}
    ];
    markets.forEach(m=>{
      const change = (Math.random()*600 - 300).toFixed(2);
      const price = (m.base + parseFloat(change)).toFixed(2);
      const pct = ((change/m.base)*100).toFixed(2);
      const card = el('div','card',`
        <div class="top"><div class="name">${m.name}</div><div class="badge">Live</div></div>
        <div class="price">‚Çπ${Number(price).toLocaleString('en-IN')}</div>
        <div class="change ${pct>=0?'pos':'neg'}">${pct>=0?'‚ñ≤':'‚ñº'} ${Math.abs(pct)}% (‚Çπ${change})</div>
        <div class="meta">Volume: ‚Çπ${(Math.random()*7000+1000).toFixed(0)} Cr</div>
      `);
      grid.appendChild(card);
    });
    // mood: compute using small synthetic calc to avoid using random each time
    const avg = markets.reduce((acc,m)=> acc + ((Math.random()*2)-1), 0) / markets.length;
    const mood = $('mood');
    if(avg>0){ mood.style.background = `linear-gradient(90deg,var(--green),#059669)`; mood.textContent = 'üöÄ Markets Bullish'; }
    else { mood.style.background = `linear-gradient(90deg,var(--red),#dc2626)`; mood.textContent = 'üìâ Markets Bearish'; }
  }
  renderIndianMarkets();

  // -------------------- CRYPTO (CoinGecko) with caching --------------------
  async function fetchCrypto(force=false){
    const grid = $('cryptoGrid');
    const cacheKey = 'em_crypto_cache';
    const cacheTimeKey = 'em_crypto_time';
    const now = Date.now();
    // show cached if available and < 60s unless forced
    if(!force){
      try{
        const cached = localStorage.getItem(cacheKey);
        const t = Number(localStorage.getItem(cacheTimeKey) || 0);
        if(cached && (now - t) < 60000){
          renderCrypto(JSON.parse(cached));
          return;
        }
      }catch(e){}
    }
    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--muted)">Loading cryptos...</div>';
    try{
      const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,dogecoin&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true');
      if(!res.ok) throw new Error('fetch failed');
      const data = await res.json();
      localStorage.setItem(cacheKey, JSON.stringify(data));
      localStorage.setItem(cacheTimeKey, String(now));
      renderCrypto(data);
    }catch(e){
      // try to show cached if exists
      const cached = localStorage.getItem(cacheKey);
      if(cached) renderCrypto(JSON.parse(cached));
      else grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--red)">Failed to load crypto data. Try refresh.</div>';
    }
  }
  function renderCrypto(data){
    const grid = $('cryptoGrid');
    grid.innerHTML = '';
    const list = [
      {id:'bitcoin',name:'Bitcoin',sym:'BTC'},
      {id:'ethereum',name:'Ethereum',sym:'ETH'},
      {id:'solana',name:'Solana',sym:'SOL'},
      {id:'dogecoin',name:'Dogecoin',sym:'DOGE'}
    ];
    list.forEach(c=>{
      const d = data[c.id];
      if(!d) return;
      const price = d.usd;
      const change = d.usd_24h_change || 0;
      const vol = d.usd_24h_vol || 0;
      const card = el('div','card',`
        <div class="top"><div class="name">${c.name} (${c.sym})</div><div class="badge">Live</div></div>
        <div class="price">$${Number(price).toLocaleString('en-US', {maximumFractionDigits:2})}</div>
        <div class="change ${change>=0?'pos':'neg'}">${change>=0?'‚ñ≤':'‚ñº'} ${Math.abs(change).toFixed(2)}%</div>
        <div class="meta">24h Vol: $${(vol/1e6).toFixed(2)}M</div>
      `);
      grid.appendChild(card);
    });
  }
  fetchCrypto();

  // auto-refresh every 60s
  setInterval(()=>{ renderIndianMarkets(); fetchCrypto(); }, 60000);

  // -------------------- MONEY MANUAL (lazy load & progressive rendering) --------------------
  // Data templates (smaller seed; programmatically tile to 500 and 100)
  const lawTemplates = [
    {title:"Spend Less Than You Earn",desc:"Wealth begins with creating a surplus. Every rupee saved becomes a tool for your financial freedom."},
    {title:"Pay Yourself First",desc:"Before paying bills or expenses, invest in your future. Your future self will be grateful for today's discipline."},
    {title:"Invest in Knowledge",desc:"Education yields the highest returns. Knowledge cannot be taxed or stolen."},
    {title:"Time Multiplies Money",desc:"Compound interest rewards patience exponentially. Start early and let time work its magic."},
    {title:"Avoid Consumer Debt",desc:"Debt for consumption enslaves; debt for assets can build wealth."},
    {title:"Diversify",desc:"Spread risk across assets but don't dilute focus."},
    {title:"Protect Capital",desc:"Preserving wealth matters more than chasing gains."},
    {title:"Live Below Means",desc:"True wealth is the gap between what you earn and what you spend."},
    {title:"Automate Savings",desc:"Systems beat willpower. Automate contributions."},
    {title:"Emergency Fund",desc:"Keep liquid buffer for shocks ‚Äî peace of mind costs little."}
  ];
  const addons = ["A cornerstone of lasting prosperity.","Wisdom applied daily.","This distinguishes the wealthy.","Start small, compound big.","A principle that outlives trends.","Guard this and grow."];
  const ALL_LAWS = (()=>{ const out=[]; for(let i=1;i<=500;i++){ const t = lawTemplates[(i-1)%lawTemplates.length]; const add = addons[Math.floor(((i-1)/lawTemplates.length)%addons.length)]; out.push({id:i,title:t.title,desc: t.desc + " " + add}); } return out; })();
  const flashTemplates = [
    {front:"Compound Interest",back:"Small consistent investments grow exponentially over time."},
    {front:"Emergency Fund",back:"6 months of expenses in liquid assets - your safety net."},
    {front:"Rupee Cost Averaging",back:"Invest fixed amounts regularly to remove emotion from investing."},
    {front:"Index Funds",back:"Low-cost, diversified, and historically strong long-term performance."},
    {front:"Passive Income",back:"Income from dividends, rent, royalties ‚Äî the road to freedom."},
    {front:"Tax Efficiency",back:"It's not what you earn but what you keep that matters."},
    {front:"Asset vs Liability",back:"Buy assets that produce income; avoid liabilities that consume it."},
    {front:"Net Worth",back:"Assets minus liabilities. The truest measure of financial health."},
    {front:"Skill Investing",back:"Skills compound too ‚Äî the more valuable your skills, the higher your returns."},
    {front:"Start Early",back:"Time is your biggest advantage in investing; use it."}
  ];
  function buildFlashcards(){ const cards=[]; for(let i=1;i<=100;i++){ const t = flashTemplates[(i-1)%flashTemplates.length]; cards.push({id:i,front:t.front,back:t.back}); } return shuffle(cards); }
  const ALL_FLASH = buildFlashcards();

  // progressive rendering controls
  let lawsDisplayed = 0;
  const LAW_BATCH = 50;
  const FLASH_BATCH = 20;

  // DOM refs
  const lawsGrid = $('lawsGrid');
  const loadMoreBtn = $('loadMore');
  const flashGrid = $('flashGrid');
  const lawSearch = $('lawSearch');

  function renderLawBatch(){
    const slice = ALL_LAWS.slice(lawsDisplayed, lawsDisplayed + LAW_BATCH);
    slice.forEach((law, idx)=>{
      const node = el('div','law',`<div class="num">Law #${law.id}</div><div class="t">${escapeHtml(law.title)}</div><div class="d">${escapeHtml(law.desc)}</div>`);
      lawsGrid.appendChild(node);
      setTimeout(()=> node.classList.add('visible'), idx * 25);
    });
    lawsDisplayed += slice.length;
    if(lawsDisplayed >= ALL_LAWS.length) loadMoreBtn.style.display = 'none';
    // observe new nodes for reveal
    observeReveals(); 
  }
  function renderFiltered(filtered){
    lawsGrid.innerHTML = '';
    filtered.slice(0,200).forEach((law, idx)=>{
      const node = el('div','law visible',`<div class="num">Law #${law.id}</div><div class="t">${escapeHtml(law.title)}</div><div class="d">${escapeHtml(law.desc)}</div>`);
      lawsGrid.appendChild(node);
    });
    loadMoreBtn.style.display = 'none';
    observeReveals();
  }

  loadMoreBtn.addEventListener('click', renderLawBatch);

  lawSearch.addEventListener('input', throttle((e)=>{
    const q = e.target.value.trim().toLowerCase();
    lawsGrid.innerHTML = '';
    lawsDisplayed = 0;
    if(!q){ loadMoreBtn.style.display = 'block'; renderLawBatch(); return; }
    const filtered = ALL_LAWS.filter(l=> (l.title + ' ' + l.desc).toLowerCase().includes(q));
    renderFiltered(filtered);
  }, 250));

  // flashcards progressive
  let flashRendered = 0;
  function renderFlashBatch(){
    const slice = ALL_FLASH.slice(flashRendered, flashRendered + FLASH_BATCH);
    slice.forEach(card=>{
      const node = el('div','flash','');
      node.innerHTML = `
        <div class="inner">
          <div class="side front"><div><strong style="color:var(--accent);font-size:1.05rem">${escapeHtml(card.front)}</strong></div></div>
          <div class="side back"><div style="color:var(--muted);font-size:0.95rem">${escapeHtml(card.back)}</div></div>
        </div>
      `;
      let pressTimer;
      node.addEventListener('click', ()=> node.classList.toggle('flip'));
      node.addEventListener('mousedown', ()=> { pressTimer = setTimeout(()=> copyToClipboard(`${card.front}\n\n${card.back}`), 800); });
      node.addEventListener('mouseup', ()=> clearTimeout(pressTimer));
      node.addEventListener('mouseleave', ()=> clearTimeout(pressTimer));
      flashGrid.appendChild(node);
    });
    flashRendered += slice.length;
    if(flashRendered < ALL_FLASH.length) setTimeout(renderFlashBatch, 260);
    observeReveals();
  }

  function copyToClipboard(text){ if(navigator.clipboard) navigator.clipboard.writeText(text).then(()=> showToast('Copied to clipboard!')); else showToast('Copy failed'); }

  // -------------------- IntersectionObserver: lazy-init the Money Manual --------------------
  let moneyInit = false;
  const moneySection = document.querySelector('#money-manual');
  const moneyObserver = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if(entry.isIntersecting && !moneyInit){
        moneyInit = true;
        // show controls and button
        $('loadMore').style.display = 'block';
        renderLawBatch(); // first batch
        renderFlashBatch();
        obs.disconnect();
      }
    });
  }, {rootMargin: '0px 0px -120px 0px', threshold: 0.15});
  if(moneySection) moneyObserver.observe(moneySection);

  // -------------------- reveal observer for animation --------------------
  const revealObserver = new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting) entry.target.classList.add('visible');
    });
  }, {threshold: 0.12});
  function observeReveals(){
    document.querySelectorAll('.card, .law, .flash').forEach(node => revealObserver.observe(node));
  }

  // -------------------- CALCULATOR --------------------
  $('calcBtn').addEventListener('click', ()=>{
    const m = parseFloat($('monthly').value) || 0;
    const r = (parseFloat($('annual').value)||0)/100;
    const y = parseFloat($('years').value) || 0;
    const n = y*12;
    const monthlyRate = r/12;
    let fv = 0;
    if(monthlyRate === 0) fv = m * n;
    else fv = m * (Math.pow(1+monthlyRate, n) - 1)/monthlyRate * (1+monthlyRate);
    const invested = m*n;
    const profit = fv - invested;
    $('invested').textContent = '‚Çπ' + Math.round(invested).toLocaleString('en-IN');
    $('final').textContent = '‚Çπ' + Math.round(fv).toLocaleString('en-IN');
    $('profit').textContent = '‚Çπ' + Math.round(profit).toLocaleString('en-IN');
    $('calcResults').style.display = 'block';
  });

  // -------------------- initial reveal observe (cards created later as well) --------------------
  observeReveals();

  // initial safe load finished
  document.addEventListener('DOMContentLoaded', ()=>{
    // pre-render nothing heavy; markets/crypto already loaded
    // ensure money section not bloated until user scrolls
  });

  // -------------------- accessibility helpers --------------------
  // smooth scroll for nav links
  document.querySelectorAll('.nav-links a').forEach(a=>{
    a.addEventListener('click', (e)=>{
      e.preventDefault();
      const href = a.getAttribute('href');
      if(href && href.startsWith('#')){
        const target = document.querySelector(href);
        if(target) target.scrollIntoView({behavior:'smooth', block:'start'});
      }
      // hide mobile menu if open
      const links = document.querySelector('.nav-links');
      if(window.innerWidth <= 880) links.style.display = 'none';
    });
  });

  // helper: manual refresh buttons (if needed)
  // EXPOSE for console: window.emRefresh = () => { renderIndianMarkets(true); fetchCrypto(true); };

})(); // end IIFE
</script>
</body>
</html>
